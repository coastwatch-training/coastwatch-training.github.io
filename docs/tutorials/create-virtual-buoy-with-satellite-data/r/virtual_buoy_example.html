<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>virtual_buoy_example – CoastWatch Training</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../images/coastwatch.png" rel="icon" type="image/png">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-973137e60ee60a7e9cda953a542133da.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
      <a href="../../../index.html" class="sidebar-logo-link">
      <img src="../../../images/coastwatch.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main">
    <a href="https://coastwatch.noaa.gov/cwn" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-globe"></i></a>
</div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../../trainings/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Training Classes</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Upcoming Trainings</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../trainings/upcoming/pgrsc26.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2026 PGRSC Course</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../trainings/upcoming/sat201_26.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2026 Satellite 201 Summer Series</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Past Trainings</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../trainings/past/icft25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2025 Satellite and Animal Telemetry</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../trainings/past/longislandsound25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2025 Long Island Sound</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../trainings/past/pgrsc24.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2024 PGRSC Workshop</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../trainings/past/seaice24.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2024 Sea Ice Data Course</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../trainings/past/afs24.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2024 AFS Workshop</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../../tutorials/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Training Tutorials</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/codegallery.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Code Gallery</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Software Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/softwarebackground.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Software Information</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/software.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Software Code Gallery</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../lectures/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Lectures</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../about.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../officehours.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Office Hours</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#virtual-buoy-example" id="toc-virtual-buoy-example" class="nav-link active" data-scroll-target="#virtual-buoy-example">Virtual Buoy example</a>
  <ul class="collapse">
  <li><a href="#objective" id="toc-objective" class="nav-link" data-scroll-target="#objective">Objective</a></li>
  <li><a href="#the-tutorial-demonstrates-the-following-techniques" id="toc-the-tutorial-demonstrates-the-following-techniques" class="nav-link" data-scroll-target="#the-tutorial-demonstrates-the-following-techniques">The tutorial demonstrates the following techniques</a></li>
  <li><a href="#datasets-used" id="toc-datasets-used" class="nav-link" data-scroll-target="#datasets-used">Datasets used</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  <li><a href="#install-required-packages-and-load-libraries" id="toc-install-required-packages-and-load-libraries" class="nav-link" data-scroll-target="#install-required-packages-and-load-libraries">Install required packages and load libraries</a></li>
  <li><a href="#download-ndbc-buoy-data" id="toc-download-ndbc-buoy-data" class="nav-link" data-scroll-target="#download-ndbc-buoy-data">Download NDBC buoy data</a></li>
  <li><a href="#visualize-sst-from-the-buoy" id="toc-visualize-sst-from-the-buoy" class="nav-link" data-scroll-target="#visualize-sst-from-the-buoy">Visualize SST from the Buoy</a></li>
  <li><a href="#download-the-satellite-sea-surface-temperature-sst-data" id="toc-download-the-satellite-sea-surface-temperature-sst-data" class="nav-link" data-scroll-target="#download-the-satellite-sea-surface-temperature-sst-data">Download the Satellite Sea Surface Temperature (SST) Data</a>
  <ul class="collapse">
  <li><a href="#send-the-satellite-data-request-to-the-coastwatch-erddap-server" id="toc-send-the-satellite-data-request-to-the-coastwatch-erddap-server" class="nav-link" data-scroll-target="#send-the-satellite-data-request-to-the-coastwatch-erddap-server">Send the satellite data request to the CoastWatch ERDDAP Server</a></li>
  </ul></li>
  <li><a href="#clean-up-the-data" id="toc-clean-up-the-data" class="nav-link" data-scroll-target="#clean-up-the-data">Clean up the data</a></li>
  <li><a href="#visualize-the-satellite-sst-data" id="toc-visualize-the-satellite-sst-data" class="nav-link" data-scroll-target="#visualize-the-satellite-sst-data">Visualize the satellite SST data</a></li>
  <li><a href="#resample-the-buoy-data-to-match-the-satellite-data" id="toc-resample-the-buoy-data-to-match-the-satellite-data" class="nav-link" data-scroll-target="#resample-the-buoy-data-to-match-the-satellite-data">Resample the buoy data to match the satellite data</a></li>
  <li><a href="#clean-up-the-downsampled-data" id="toc-clean-up-the-downsampled-data" class="nav-link" data-scroll-target="#clean-up-the-downsampled-data">Clean up the downsampled data</a></li>
  <li><a href="#visualize-the-downsampled-buoy-data" id="toc-visualize-the-downsampled-buoy-data" class="nav-link" data-scroll-target="#visualize-the-downsampled-buoy-data">Visualize the downsampled buoy data</a></li>
  <li><a href="#merge-satellite-and-buoy-data" id="toc-merge-satellite-and-buoy-data" class="nav-link" data-scroll-target="#merge-satellite-and-buoy-data">Merge Satellite and Buoy data</a></li>
  <li><a href="#plot-both-satellite-and-buoy-data" id="toc-plot-both-satellite-and-buoy-data" class="nav-link" data-scroll-target="#plot-both-satellite-and-buoy-data">Plot both satellite and buoy data</a></li>
  <li><a href="#plot-satellite-vs.-buoy-data-and-overlay-the-regression-line" id="toc-plot-satellite-vs.-buoy-data-and-overlay-the-regression-line" class="nav-link" data-scroll-target="#plot-satellite-vs.-buoy-data-and-overlay-the-regression-line">Plot satellite vs.&nbsp;buoy data and overlay the regression line</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>




<section id="virtual-buoy-example" class="level1">
<h1>Virtual Buoy example</h1>
<blockquote class="blockquote">
<p>Updated August 2023 <br></p>
</blockquote>
<p>There are buoys in many locations around the world that provide data streams of oceanic and atmospheric parameters. The data are often available through data centers like the National Data Buoy Center (NDBC <a href="https://www.ndbc.noaa.gov" class="uri">https://www.ndbc.noaa.gov</a>), ARGO floats program (<a href="http://www.argo.ucsd.edu" class="uri">http://www.argo.ucsd.edu</a>) or CoastWatch ERDDAP data servers (<a href="https://coastwatch.pfeg.noaa.gov/erddap/" class="uri">https://coastwatch.pfeg.noaa.gov/erddap/</a>). In situ buoy data are widely used to monitor environmental conditions. In the absence of in situ buoy data - whether the buoy operation is discontinued, interrupted, or limited - satellite data within temporal and spatial coverage of the desired locationcan be used to create a time series of a parameter of interest.</p>
<section id="objective" class="level2">
<h2 class="anchored" data-anchor-id="objective">Objective</h2>
<p>This tutorial will demonstrate how to create a time series from satellite data to gap-fill or replace buoy data.</p>
</section>
<section id="the-tutorial-demonstrates-the-following-techniques" class="level2">
<h2 class="anchored" data-anchor-id="the-tutorial-demonstrates-the-following-techniques">The tutorial demonstrates the following techniques</h2>
<ul>
<li>Downloading the satellite and buoy data from ERDDAP data server</li>
<li>Visualizing the datasets</li>
<li>Reshaping the satellite data into a buoy data format</li>
<li>Resampling buoy data (aggregation) to match satellite data temporal resolution</li>
<li>Validating the satellite data with the actual buoy data</li>
<li>Performing a linear regression of satellite vs.&nbsp;buoy data</li>
<li>Creating a scatter plot of satellite vs.&nbsp;buoy data with the regression line</li>
</ul>
</section>
<section id="datasets-used" class="level2">
<h2 class="anchored" data-anchor-id="datasets-used">Datasets used</h2>
<p><strong>Sea-Surface Temperature, NOAA Geo-polar Blended Analysis Day+Night, GHRSST,Near Real-Time, Global 5km, 2019-Present, Daily</strong><br>
<a href="https://coastwatch.pfeg.noaa.gov/erddap/griddap/nesdisBLENDEDsstDNDaily.graph" target="_blank">.</a></p><a href="https://coastwatch.pfeg.noaa.gov/erddap/griddap/nesdisBLENDEDsstDNDaily.graph" target="_blank">
</a><p><a href="https://coastwatch.pfeg.noaa.gov/erddap/griddap/nesdisBLENDEDsstDNDaily.graph" target="_blank"><strong>NDBC Standard Meteorological Buoy Data, 1970-present</strong> </a><a href="https://coastwatch.pfeg.noaa.gov/erddap/tabledap/cwwcNDBCMet.graph?time%2Cwtmp%2Cwd&amp;station=%2246259%22&amp;time%3E=2020-09-15T00%3A00%3A00Z&amp;time%3C=2022-09-15T00%3A00%3A00Z&amp;.draw=markers&amp;.marker=5%7C5&amp;.color=0x000000&amp;.colorBar=%7C%7C%7C%7C%7C&amp;.bgColor=0xffccccff"> NDBC Standard Meteorological Buoy Data </a> from the buoy station no. <strong>46259</strong> are from off the California coast at 34.737N latitude and 121.664E longitude.</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<ul>
<li><a href="https://coastwatch.pfeg.noaa.gov/data.html">NOAA CoastWatch Westcoast Node Data Catalog</a></li>
<li><a href="https://www.ndbc.noaa.gov/download_data.php?filename=46259h2017.txt.gz&amp;dir=data/historical/stdme ">NOAA National Data Buoy Center</a></li>
</ul>
</section>
<section id="install-required-packages-and-load-libraries" class="level2">
<h2 class="anchored" data-anchor-id="install-required-packages-and-load-libraries">Install required packages and load libraries</h2>
<pre><code># Function to check if pkgs are installed, and install any missing pkgs
pkgTest &lt;- function(x)
{
  if (!require(x,character.only = TRUE))
  {
    install.packages(x,dep=TRUE,repos='http://cran.us.r-project.org')
    if(!require(x,character.only = TRUE)) stop(x, " :Package not found")
  }
}


# Create list of required packages
list.of.packages &lt;- c("utils", "ggplot2", "dplyr", "lubridate")

# Create list of installed packages
pkges = installed.packages()[,"Package"]

# Install and load all required pkgs
for (pk in list.of.packages) {
  pkgTest(pk)
}</code></pre>
</section>
<section id="download-ndbc-buoy-data" class="level2">
<h2 class="anchored" data-anchor-id="download-ndbc-buoy-data">Download NDBC buoy data</h2>
<p>We will download NDBC buoy data between January 16, 2022 and August 16, 2022 from the CoastWatch ERDDAP server.</p>
<p>The data can be downloaded by sending a data request to the ERDDAP server via URL. The data request URL includes the dataset ID of interest and other query conditions if subset of the data product is of interest.</p>
<p>To learn more about how to set up ERDDAP URL data requests, please go to the <a href="" target="_blank">ERDDAP module page</a>.</p>
<pre><code># Set the ERDDAP data request URL
 
buoy_url &lt;- "https://coastwatch.pfeg.noaa.gov/erddap/tabledap/cwwcNDBCMet.csv?time%2Clongitude%2Clatitude%2Cwtmp&amp;station%3E=%2246259%22&amp;station%3C=%2246259%22&amp;time%3E=2022-01-16T00%3A00%3A00Z&amp;time%3C=2022-08-16T17%3A52%3A00Z"

# Set file name
fname = 'buoy.csv'

# Download file
download.file(buoy_url, fname)


# Read into data frame, skip first 2 rows that contain variable names and units
 
buoy_df &lt;- read.csv(fname, skip=2, header=TRUE)

# Name the columns
names(buoy_df) &lt;- c("utc", "lon", "lat", "sst" )

# Add additional date column
buoy_df$date &lt;- as.Date(buoy_df$utc, tz = "UTC")

# Show the first 3 rows
head(buoy_df, 3)

##                    utc      lon    lat  sst       date
## 1 2022-01-16T00:56:00Z -121.664 34.732 13.4 2022-01-16
## 2 2022-01-16T01:26:00Z -121.664 34.732 13.4 2022-01-16
## 3 2022-01-16T01:56:00Z -121.664 34.732 13.3 2022-01-16</code></pre>
</section>
<section id="visualize-sst-from-the-buoy" class="level2">
<h2 class="anchored" data-anchor-id="visualize-sst-from-the-buoy">Visualize SST from the Buoy</h2>
<pre><code>options(repr.plot.width = 10)

ggplot(buoy_df, aes(x = date, y = sst)) +
  geom_line(color='blue') +
 # geom_point(size=.2, color='red')+
  theme(axis.text.x = element_text(angle = 90),plot.title=element_text(hjust=0.5))+
   labs(x="Date", y="Sea Surface Temp (Celsius)", title="SST from NDBC Buoy Station: 46259 (Aug 2022- Aug 2023) ")</code></pre>
<p><img src="images/unnamed-chunk-2-1.png" class="img-fluid"></p>
</section>
<section id="download-the-satellite-sea-surface-temperature-sst-data" class="level2">
<h2 class="anchored" data-anchor-id="download-the-satellite-sea-surface-temperature-sst-data">Download the Satellite Sea Surface Temperature (SST) Data</h2>
<p>The satellite Sea Surface Temperature (SST) product we will use is the NOAA GeoPolar Blended SST dataset (in Celsius), which blends data from many satellite sensors to obtain good daily coverage of the globe at 5km resolution, and then an interpolation method is applied to fill in data gaps.</p>
<p>The data request can be sent to a CoastWatch ERDDAP server via URL with a query string to specify the temporal and spatial coverage of interest. In this case, we want to subset the satellite data to match the buoy station location and time range.</p>
<section id="send-the-satellite-data-request-to-the-coastwatch-erddap-server" class="level3">
<h3 class="anchored" data-anchor-id="send-the-satellite-data-request-to-the-coastwatch-erddap-server">Send the satellite data request to the CoastWatch ERDDAP Server</h3>
<pre><code># Set ERDDAP URL for the satellite data
url &lt;- "https://coastwatch.pfeg.noaa.gov/erddap/griddap/nesdisBLENDEDsstDNDaily.csv?analysed_sst%5B(2022-01-16T12:00:00Z):1:(2022-08-16T12:00:00Z)%5D%5B(34.737):1:(34.737)%5D%5B(-121.664):1:(-121.664)%5D"

# Set file name
fname = 'sst.csv'

# Download file
download.file(url, fname)


# Read into data frame, skip first 2 rows that contain variable names and units
sst_df &lt;- read.csv(fname, skip=2, header=TRUE)
names(sst_df) &lt;- c("utc", "lat", "lon", "sst")

# Add formatted data column
sst_df$date &lt;- as.Date(sst_df$utc, tz = "UTC")

# Show the first 3 rows
head(sst_df, 3)

##                    utc    lat      lon      sst       date
## 1 2022-01-18T12:00:00Z 34.725 -121.675 13.49999 2022-01-18
## 2 2022-01-19T12:00:00Z 34.725 -121.675 13.44999 2022-01-19
## 3 2022-01-20T12:00:00Z 34.725 -121.675 13.53999 2022-01-20</code></pre>
</section>
</section>
<section id="clean-up-the-data" class="level2">
<h2 class="anchored" data-anchor-id="clean-up-the-data">Clean up the data</h2>
<p>Apply a conservative allowable data range. For the lower end of the range, the freezing point of seawater (ca. -2). For the high end of the range, a value unlikely to be seen in the area of interest (e.g.&nbsp;45 degrees C).</p>
<pre><code># Filter data that are within the valid range (-2 and 45)
sst_df_clean = sst_df %&gt;%
  filter(sst &gt;=-2 &amp; sst &lt;= 45)</code></pre>
</section>
<section id="visualize-the-satellite-sst-data" class="level2">
<h2 class="anchored" data-anchor-id="visualize-the-satellite-sst-data">Visualize the satellite SST data</h2>
<pre><code># Plot sea surface temperature values from satellite
p &lt;- ggplot(sst_df, aes(x = date, y = sst)) +
  geom_line(color='blue') +
  geom_point(size=.5, color='red')+
  theme(axis.text.x = element_text(angle = 90),plot.title=element_text(hjust=0.5))+
   labs(x="Date", y="Sea Surface Temp (Celcius)", title="Sea surface temperature from satellite")
p</code></pre>
<p><img src="images/unnamed-chunk-5-1.png" class="img-fluid"></p>
</section>
<section id="resample-the-buoy-data-to-match-the-satellite-data" class="level2">
<h2 class="anchored" data-anchor-id="resample-the-buoy-data-to-match-the-satellite-data">Resample the buoy data to match the satellite data</h2>
<p>The sampling resolution for the buoy data is a sample every 30 minutes. However, the temporal resolution for the satellite dataset is daily. We will downsample the buoy data by computing daily mean to match the temporal resolution of the satellite data.</p>
<pre><code># Aggregating (taking a mean value) grouped by day
buoy_ds &lt;- buoy_df %&gt;%
  group_by(date = floor_date(date, unit="days")) %&gt;%
  summarise(mean_sst = mean(sst))

# Show first 3 rows
head(buoy_ds, 3)

## # A tibble: 3 × 2
##   date       mean_sst
##   &lt;date&gt;        &lt;dbl&gt;
## 1 2022-01-16     13.4
## 2 2022-01-17     13.5
## 3 2022-01-18     13.6</code></pre>
</section>
<section id="clean-up-the-downsampled-data" class="level2">
<h2 class="anchored" data-anchor-id="clean-up-the-downsampled-data">Clean up the downsampled data</h2>
<p>Apply a conservative allowable data range. For the lower end of the range, the freezing point of seawater (ca. -2). For the high end of the range, value unlikely to be seen in the area of interest (e.g.&nbsp;45 degrees C).</p>
<pre><code># Remove outliers sst values outside of -2 and 45 deg C
buoy_ds_clean = buoy_ds %&gt;%
  filter(mean_sst &gt;=-2 &amp; mean_sst &lt;= 45)</code></pre>
</section>
<section id="visualize-the-downsampled-buoy-data" class="level2">
<h2 class="anchored" data-anchor-id="visualize-the-downsampled-buoy-data">Visualize the downsampled buoy data</h2>
<pre><code># Plot daily mean sst
ggplot(buoy_ds_clean, aes(x = date, y = mean_sst)) +
  geom_line(color='blue') +
  geom_point(size=.5, color='red')+
  theme(axis.text.x = element_text(angle = 90),plot.title=element_text(hjust=0.5))+
   labs(x="Date", y="Sea Surface Temp (Celcius)", title="2022 Aug- 2023 Aug Downsampled Buoy SST")</code></pre>
<p><img src="images/unnamed-chunk-8-1.png" class="img-fluid"></p>
</section>
<section id="merge-satellite-and-buoy-data" class="level2">
<h2 class="anchored" data-anchor-id="merge-satellite-and-buoy-data">Merge Satellite and Buoy data</h2>
<p>We will use dplyr::inner_join() function to merge the two data frames (satellite and buoy data) based on the dates that appear in both data frames.</p>
<pre><code># Combine two data frames with date column where dates exist in both data frames
merged_df &lt;- inner_join(sst_df_clean[c("date", "sst")],  buoy_ds_clean, by = "date")</code></pre>
</section>
<section id="plot-both-satellite-and-buoy-data" class="level2">
<h2 class="anchored" data-anchor-id="plot-both-satellite-and-buoy-data">Plot both satellite and buoy data</h2>
<pre><code># Plot satellite sst and buoy daily mean sst 
p &lt;- ggplot(merged_df, aes(x = date)) +  
    geom_line(aes(y = sst, color = "Satellite")) +   
    geom_line(aes(y = mean_sst, color = "NDBC Buoy")) +   
    scale_color_manual(name = "Data source", 
                       values = c("Satellite" = "blue", "NDBC Buoy" = "orange"))+
    labs( x = "Date", y = "Temperature (in Celsius)", title="SST from Satellite and NDBC Buoy" )+
    theme(axis.text.x = element_text(angle = 0),plot.title=element_text(hjust=0.5))
p</code></pre>
<p><img src="images/unnamed-chunk-10-1.png" class="img-fluid"> ## Perform a simple linear regression</p>
<pre><code># Run linear regression 
model &lt;- lm(mean_sst ~ sst, data = merged_df)   
summary(model)

## 
## Call:
## lm(formula = mean_sst ~ sst, data = merged_df)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1.48812 -0.21354 -0.02782  0.14581  1.67408 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  0.54793    0.30272    1.81   0.0718 .  
## sst          0.96142    0.02221   43.29   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.4462 on 203 degrees of freedom
## Multiple R-squared:  0.9023, Adjusted R-squared:  0.9018 
## F-statistic:  1874 on 1 and 203 DF,  p-value: &lt; 2.2e-16</code></pre>
</section>
<section id="plot-satellite-vs.-buoy-data-and-overlay-the-regression-line" class="level2">
<h2 class="anchored" data-anchor-id="plot-satellite-vs.-buoy-data-and-overlay-the-regression-line">Plot satellite vs.&nbsp;buoy data and overlay the regression line</h2>
<pre><code>ggplot(merged_df, aes(x=sst, y=mean_sst)) +
  geom_point(color="black", size=1) +                      # Plot the data points
  geom_smooth(method="lm", se=FALSE) +
  labs(x = "SST from Buoy", y = "SST from Satellite", title = "Satellite vs Buoy data with regression line") +
  theme(plot.title=element_text(hjust=0.5))

## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="images/unnamed-chunk-12-1.png" class="img-fluid"></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© CC-By CoastWatch, 2026</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>